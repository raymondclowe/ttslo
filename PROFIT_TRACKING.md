# Profit Tracking and Reporting

TTSLO now includes comprehensive profit tracking to monitor and report on trading performance.

## Overview

The profit tracking system automatically records every trade from trigger to fill, calculating profit/loss based on entry and exit prices. This provides visibility into trading performance without manual tracking.

**Integration with coin_stats.py**: When using configurations generated by `tools/coin_stats.py`, the profit tracker automatically identifies and tracks profits from these suggestions separately from manual configurations, allowing you to compare the effectiveness of algorithmic vs manual trading strategies.

## Features

### Automatic Tracking
- **Order Triggers**: Recorded when TTSLO creates an order
- **Order Fills**: Updated when Kraken reports order completion
- **Profit Calculation**: Automatic based on direction and prices
- **CSV Storage**: All trades stored in `trades.csv`

### Profit Calculation

**For SELL orders** (sell high, buy back low):
```
Profit = (Entry Price - Exit Price) × Volume
```
Example: Sell BTC at $50,000, buy back at $49,000
- Profit = ($50,000 - $49,000) × 0.01 = $10

**For BUY orders** (buy low, sell high):
```
Profit = (Exit Price - Entry Price) × Volume
```
Example: Buy BTC at $49,000, sell at $50,000
- Profit = ($50,000 - $49,000) × 0.01 = $10

## Usage

### View Profit Summary
```bash
uv run python tools/profit_report.py
```

Output:
```
======================================================================
PROFIT SUMMARY REPORT
======================================================================
Total Trades: 10
  - Completed: 8
  - Triggered (Pending): 2

Total P&L: $127.50

Profitable Trades: 6
Losing Trades: 2
Win Rate: 75.0%

Average Profit: $25.50
Average Loss: $12.50
Largest Win: $45.00
Largest Loss: $20.00
======================================================================
```

### Detailed Trade History
```bash
uv run python tools/profit_report.py --detailed
```

Shows individual trade details:
- Trade ID
- Trading pair
- Direction (buy/sell)
- Entry/exit prices
- Profit/loss amount and percentage
- Status

### Profit by Source (coin_stats vs Manual)
```bash
uv run python tools/profit_report.py --by-source
```

Shows profit breakdown between:
- **coin_stats.py suggestions**: Configs generated by the statistical analysis tool
- **Manual configs**: Manually created configurations

This helps evaluate the effectiveness of algorithmic suggestions vs manual strategies.

### Profit by Trading Pair
```bash
uv run python tools/profit_report.py --by-pair
```

Groups profits by trading pair to identify which assets are most profitable.

### Performance Metrics
```bash
uv run python tools/profit_report.py --metrics
```

Advanced metrics:
- Win rate
- Profit factor (ratio of gross profit to gross loss)
- Expected value per trade
- Risk/reward ratio

### All Reports Combined
```bash
uv run python tools/profit_report.py --all
```

## Data Structure

### trades.csv Columns

| Column | Description |
|--------|-------------|
| `trade_id` | Unique identifier for the trade |
| `config_id` | Configuration ID from config.csv |
| `pair` | Trading pair (e.g., XXBTZUSD) |
| `direction` | Order direction (buy/sell) |
| `volume` | Trade volume |
| `entry_price` | Price when order triggered |
| `exit_price` | Price when order filled |
| `entry_time` | Timestamp when triggered |
| `exit_time` | Timestamp when filled |
| `profit_loss` | Profit/loss amount |
| `profit_loss_pct` | Profit/loss percentage |
| `status` | Trade status (triggered/completed/filled_only) |
| `notes` | Additional information |

### Trade Status

- **triggered**: Order created, awaiting fill
- **completed**: Order filled, profit calculated
- **filled_only**: Order filled without tracked entry (unusual case)

## Integration with coin_stats.py

The profit tracking system seamlessly integrates with configurations generated by `tools/coin_stats.py`:

### Automatic Detection
- Config IDs from coin_stats follow pattern: `{pair}_{direction}_{timestamp}_{count}`
  - Example: `eth_usd_sell_202510300602_1`
- Profit tracker automatically identifies these patterns
- No manual tagging or configuration needed

### Source Comparison
Use `--by-source` to compare performance:
```bash
uv run python tools/profit_report.py --by-source
```

Output example:
```
PROFIT BY SOURCE (coin_stats suggestions vs manual configs)
========================================================================
Source               Trades     Wins     Losses     Total P&L       Win Rate    
------------------------------------------------------------------------
coin_stats.py        15         11       4          $247.50         73.3%
Manual Config        5          3        2          $45.00          60.0%
```

This helps answer:
- Are statistical suggestions more profitable than manual configs?
- What's the win rate difference between approaches?
- Should you trust coin_stats suggestions?

## Integration with Issue #195

The profit tracking system addresses the requirements from issue #195:

1. **Profits Attempted**: `triggered` status shows pending opportunities
2. **Profits Made**: `completed` trades with calculated P&L
3. **Potential**: Pending trades show what might be realized
4. **Executive Summary**: Comprehensive reports at multiple levels
5. **coin_stats Integration**: Tracks performance of suggested configs separately

## Example Workflow

1. TTSLO monitors price and threshold is met
2. Order created → **ProfitTracker** records entry:
   - Entry price
   - Volume
   - Timestamp
   - Status: `triggered`

3. Order fills on Kraken → **ProfitTracker** updates:
   - Exit price
   - Exit timestamp
   - Calculates profit/loss
   - Status: `completed`

4. Generate report anytime:
   ```bash
   uv run python tools/profit_report.py --all
   ```

## File Location

Trades are stored in `trades.csv` in the same directory as `state.csv` (default: current directory).

Custom location:
```bash
uv run python tools/profit_report.py --trades-file /path/to/trades.csv
```

## Tips

- Run reports regularly to track performance trends
- Use `--by-pair` to identify best performing assets
- Monitor win rate to assess strategy effectiveness
- Compare average profit vs average loss for risk management
- Use `--detailed` to review specific trades for patterns

## Privacy & Security

- trades.csv contains only aggregated trade data
- No API keys or sensitive credentials stored
- CSV format allows easy backup and analysis
- Can be excluded from git with `.gitignore` if desired
